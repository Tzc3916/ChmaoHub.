-- Chmao脚本中心UI（功能修复版 | UI无改动）
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")
local Players = game:GetService("Players")
local LP = Players.LocalPlayer

-- 创建主UI（完全保留你的原始UI代码）
local Main = Instance.new("ScreenGui")
Main.Name = "ChmaoScriptUI"
Main.ResetOnSpawn = false
Main.Parent = game.CoreGui

-- 主框架（保持不变）
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 500, 0, 300)
Frame.Position = UDim2.new(0.5, -250, 0.5, -150)
Frame.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
Frame.BackgroundTransparency = 0.15
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Visible = false
Frame.Parent = Main

-- ...（中间所有UI代码完全不变，包括你的圆角、颜色、按钮样式等）...

-- ===== 仅修复功能部分 =====
-- 1. 人物速度加速（修复角色检测）
speedBtn.MouseButton1Click:Connect(function()
    local char = LP.Character or LP.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid")
    hum.WalkSpeed = 50
    speedBtn.Text = "速度加速 (50)"
end)

-- 2. 超级跳跃（直接修改JumpPower）
jumpBtn.MouseButton1Click:Connect(function()
    local char = LP.Character or LP.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid")
    hum.JumpPower = 100
    jumpBtn.Text = "跳跃高度 (100)"
end)

-- 3. 无限跳跃（移除_G变量，改用局部存储）
local InfJumpEnabled = false
infJumpBtn.MouseButton1Click:Connect(function()
    InfJumpEnabled = not InfJumpEnabled
    infJumpBtn.Text = InfJumpEnabled and "无限跳跃 (开启)" or "无限跳跃"
end)

UIS.JumpRequest:Connect(function()
    if InfJumpEnabled and LP.Character then
        local hum = LP.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)

-- 4. 穿墙模式（优化循环检测）
local NoClipEnabled = false
noclipBtn.MouseButton1Click:Connect(function()
    NoClipEnabled = not NoClipEnabled
    noclipBtn.Text = NoClipEnabled and "穿墙模式 (开启)" or "穿墙模式"
    
    if NoClipEnabled then
        RS.Stepped:Connect(function()
            if not NoClipEnabled or not LP.Character then return end
            for _, part in ipairs(LP.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end)
    end
end)

-- 5. 飞行模式（修复BodyVelocity问题）
local FlyEnabled = false
local flyBV, flyBG

flyBtn.MouseButton1Click:Connect(function()
    FlyEnabled = not FlyEnabled
    flyBtn.Text = FlyEnabled and "飞行模式 (开启)" or "飞行模式"
    
    if FlyEnabled then
        local char = LP.Character or LP.CharacterAdded:Wait()
        local root = char:WaitForChild("HumanoidRootPart")
        
        flyBG = Instance.new("BodyGyro", root)
        flyBG.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        flyBG.P = 1e4
        
        flyBV = Instance.new("BodyVelocity", root)
        flyBV.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        
        RS.Stepped:Connect(function()
            if not FlyEnabled or not LP.Character then return end
            local cam = workspace.CurrentCamera.CFrame
            local move = Vector3.new()
            
            if UIS:IsKeyDown(Enum.KeyCode.W) then move = move + cam.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then move = move - cam.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then move = move - cam.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.D) then move = move + cam.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.Space) then move = move + Vector3.new(0, 1, 0) end
            if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then move = move + Vector3.new(0, -1, 0) end
            
            flyBV.Velocity = move.Magnitude > 0 and move.Unit * 50 or Vector3.new(0, 0.1, 0)
        end)
    else
        if flyBV then flyBV:Destroy() end
        if flyBG then flyBG:Destroy() end
    end
end)

-- 剩余UI交互代码（页签切换、拖动逻辑等）完全保持不变